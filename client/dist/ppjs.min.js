/*! ppjs v1.0.0 2013-11-16 */
!function(a){"use strict";a.SocketIO=function(a){function b(){c(),w.onServerConnection()}function c(){o.on("failed",k),o.on("join",h),o.on("joined",i),o.on("leave",j),o.on("full",l),o.on("message",m),o.on("log",n)}function d(a){!s&&t&&(s=!0,"function"==typeof w.onConnected&&w.onConnected(r,p,a))}function e(a){s=!1,"undefined"!=typeof a&&(q=a),console.log("server connected?? ",u," -- Joining ",v," -- code: ",q),o.emit("create or join",{room:v,pin:q,username:w.username})}function f(){console.log("leaving channell....."),s=!1,o.emit("leave",v)}function g(a,b,c){o.emit("message",a,b,c)}function h(a){t=!0,s=!1,console.debug("________________________________"),console.debug("User joins: ",a),d(a.connections)}function i(a){a.initiator?(console.debug("Room created: ",a),r=!0):t=!0,console.debug("----------Room joined: ",a),p=a.clientid,d(a.connections)}function j(){"function"==typeof w.onLeave&&w.onLeave()}function k(){console.log("Failed: You must enter a valid code!!!"),"function"==typeof w.onFailed&&w.onFailed()}function l(){console.error("ROOM FULL")}function m(a,b,c){"offer"===a.type?(console.log("Offer received!!!! ",b,c),"function"==typeof w.onOffer&&w.onOffer(a,b,c)):"answer"===a.type&&s?"function"==typeof w.onAnswer&&w.onAnswer(a,b,c):"candidate"===a.type&&s&&"function"==typeof w.onCandidate&&w.onCandidate(a,b,c)}function n(a){console.log.apply(console,a)}var o,p,q,r=!1,s=!1,t=!1,u=!1,v="test",w={url:"http://192.168.0.15:8889/",onConnected:function(){},onOffer:function(){},onAnswer:function(){},onCandidate:function(){},onFailed:function(){},onLeave:function(){},onServerConnection:function(){}};return function(){Object.extend(w,a),o=io.connect(w.url),o.on("connect",b)}(),{join:e,leave:f,send:g}}}(window.ppjs=window.ppjs||{}),function(a){"use strict";a.XHR=function(a){function b(a,b){function c(){if(console.log("Handle response: ",d),4===d.readyState&&200===d.status&&"function"==typeof b){var a=JSON.parse(d.responseText);b(a)}}var d;if(window.XMLHttpRequest)d=new XMLHttpRequest;else if(window.ActiveXObject)try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){d=new ActiveXObject("Microsoft.XMLHTTP")}return d?(d.onreadystatechange=c,console.log("ajax: ",d),d.open("GET",a,!0),d.send(),void 0):!1}function c(a){"undefined"!=typeof a&&(g=a),console.log("Joining ",i," -- code: ",g)}function d(){console.log("leaving channell....."),h=!1,f.emit("leave",i)}function e(a){f.emit("message",a)}var f,g,h=!1,i="test",j={url:"http://172.16.3.157/rtdroid/php/",onConnected:function(){},onOffer:function(){},onAnswer:function(){},onCandidate:function(){},onFailed:function(){},onLeave:function(){}};return function(){Object.extend(j,a),b(j.url,function(){})}(),{join:c,leave:d,send:e}}}(window.ppjs=window.ppjs||{}),function(a){"use strict";a.Data=function(b,c){function d(){console.debug("################ new data added ########"),k=new a.RTC(b,{data:!0,channel:n.channel,onMessage:g,onLeave:h,onConnected:f})}function e(){m.addEventListener("keyup",function(a){13===a.keyCode&&(k.send(m.value),m.value="")})}function f(){console.log("<<<<<<<<<<< connected >>>>>>>>>>"),m.disabled=!1}function g(a){console.log("ppjs.Data.onMessage: ",a),l.value+=a}function h(){console.log("ppjs.Data.onLeave")}function i(){k.leave()}function j(a){k.send(a)}{var k,l,m,n={data:!0,container:"[name=group-conversation]",control:"[name=conversation]",channel:"SocketIO",onConnected:function(){},onMessage:function(){}};({data:n.data})}return function(){Object.extend(n,c),console.log("ppjs.DATA STREAM using: ",n.channel),l=document.querySelector(n.container),m=document.querySelector(n.control),d(),console.log("Joining with: ",b),e()}(),{leave:i,send:j}}}(window.ppjs=window.ppjs||{}),function(a){"use strict";a.Peer=function(a,b,c,d){function e(){n=new RTCPeerConnection(r,s),console.log("===================================new peerConnection!!!! ",q," -- to: ",c),u.video&&"undefined"!=typeof u.stream&&(n.addStream(u.stream),console.debug(">>>>>>>Adding stream....... ",n.getLocalStreams()[0].id),n.onaddstream=function(a){console.log("Remote Stream added!!!!!!!!!",n.getRemoteStreams()[0].id),"function"==typeof u.onRemoteStream&&u.onRemoteStream(a.stream)}),n.onicecandidate=function(a){a.candidate?l({type:"candidate",label:a.candidate.sdpMLineIndex,id:a.candidate.sdpMid,candidate:a.candidate.candidate}):(console.warn("-------End of Candidates------ is Connected"),p=!0,u.onConnected())},n.onsignalingstatechange=function(a){console.log("pc.onsignalingstatechange: ",a)},n.ondatachannel=function(a){console.log(">>>>>>listening data channel: ",a.channel),o=a.channel,g()},q&&(u.data&&(console.warn("-------- initiator wants to create a new DataChannel -------"),o=n.createDataChannel("dataChannel",{reliable:!0}),g()),f(c))}function f(a){console.warn("ppjs.RTC >> createOFFER >>> ",a),n.createOffer(function(b){h(b,a)},null,t)}function g(){o.onmessage=function(a){console.log("message sent over RTC DataChannel> ",a.data),p&&"function"==typeof u.onMessage&&u.onMessage(a.data)},o.onerror=function(a){console.log("channel error: ",a)},o.onclose=function(a){console.log("channel closed: ",a)},o.onopen=function(a){console.log("channel openned: ",a)}}function h(a,b){console.log("setLocalAndSendMessage: ",q,b),n.setLocalDescription(a),l(a,b)}function i(a){console.log("Connect PC1 in PC2 >>>>> createAnswer------- > ",a),n.setRemoteDescription(new RTCSessionDescription(a)),n.createAnswer(h,null,t)}function j(a){console.log("Connect PC2 in PC1 <<<<<<< !!! set remote desc ",a),n.setRemoteDescription(new RTCSessionDescription(a))}function k(a){var b=new RTCIceCandidate({sdpMLineIndex:a.label,candidate:a.candidate});n.addIceCandidate(b)}function l(a){p?(console.debug("CHANNEL.send: ",a,m,c),o.send(a)):u.onMessage(a,m,c)}var m,n,o,p=!1,q=!1,r={iceServers:[{url:"stun:stun.l.google.com:19302"}]},s={optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!0}]},t={optional:[],mandatory:{OfferToReceiveAudio:d&&d.audio,OfferToReceiveVideo:d&&d.video}},u={audio:!1,video:!1,data:!0,stream:void 0,onMessage:function(){},onConnected:function(){},onRemoteStream:function(){}};return function(){Object.extend(u,d),m=b,q=a,e()}(),{send:l,setOfferer:i,setAnswerer:j,addCandidate:k}}}(window.ppjs=window.ppjs||{}),function(a){"use strict";a.RTC=function(b,c){function d(b,c,d){s=b,o=c,console.debug("prp.RTC.buildConnection >>>>> ",s,c);for(var f=0,i=g(d),j=i.length;j>f;f++)1===f&&(s=!0),console.log("Creating new peer........ ",i[f]),q[i[f]]=new a.Peer(s,o,i[f],{audio:t.audio,video:t.video,data:t.data,stream:t.stream,onRemoteStream:h,onMessage:m,onConnected:e})}function e(){r=!0,t.onConnected()}function f(){return s}function g(a){for(var b=0,c=[],d=a.length;d>b;b++)a[b]!==o&&"undefined"==typeof q[a[b]]&&c.push(a[b]);return c}function h(a){"function"==typeof t.onRemoteStream&&t.onRemoteStream(a)}function i(a,b,c){console.log("RTC.On setOfferer: ",b,c),q[b]&&q[b].setOfferer(a)}function j(a,b,c){console.log("RTC.On setAnswerer: ",b,c),q[b]&&q[b].setAnswerer(a)}function k(a,b,c){console.log("RTC.On addCandidate: ",b,c),q[b]&&q[b].addCandidate(a)}function l(){console.log("RTC.LEAVE!!!!!")}function m(a,b,c){r?t.onMessage(a):p.send(a,b,c)}function n(a){if(r){console.debug("SEND VIA RTC: ",a,q.length);for(var b in q)q[b].send(a)}}var o,p,q={},r=!1,s=!1,t={audio:!1,video:!1,data:!0,channel:"SocketIO",stream:void 0,onMessage:function(){},onRemoteStream:function(){},onConnected:function(){}};return function(){Object.extend(t,c),console.debug("////////// new signalingChannel /////////"),p=new a[t.channel]({onConnected:d,onOffer:i,onAnswer:j,onCandidate:k,onServerConnection:function(){console.log("joining......................"),p.join(b)}})}(),{initiator:f,leave:l,send:n}}}(window.ppjs=window.ppjs||{}),function(a){"use strict";a.Stream=function(b,c){function d(){navigator.getUserMedia(n,e,function(a){console.log("Navigator.getUserMedia ERROR: ",a)})}function e(c){f(c,!0),console.debug("################ new camera added ########"),k=new a.RTC(b,{audio:m.audio,video:m.video,data:!1,stream:c,channel:m.channel,onMessage:g,onLeave:h,onRemoteStream:f})}function f(a,b){console.log("Creating new video.... ",a,b);var c=document.createElement("video");c.src=URL.createObjectURL(a),c.play(),l.appendChild(c)}function g(a){console.log("ppjs.Stream.onMessage: ",a)}function h(){console.log("ppjs.Stream.onLeave")}function i(){k.leave()}function j(){}var k,l,m={audio:!0,video:!0,container:".video-container",channel:"SocketIO",onConnected:function(){},onRemoteStream:function(){}},n={video:m.video,audio:m.audio};return function(){Object.extend(m,c),console.log("ppjs.Stream using: ",m.channel),l=document.querySelector(m.container),d(),console.log("Joining with: ",b)}(),{leave:i,send:j}}}(window.ppjs=window.ppjs||{}),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.AudioContext=window.AudioContext||window.webkitAudioContext,window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate,Object.extend=function(a,b){for(var c in b)a[c]=b[c];return a};